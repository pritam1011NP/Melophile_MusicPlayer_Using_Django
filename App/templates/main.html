<div class="tf-grid">
  {% for item in page_obj %}
  <!-- Left: Player Card -->
  <section class="Melophile glass" data-song-id="{{ item.id }}">
    <div class="cover">
      <img alt="{{item.title}} cover" src="{{item.image.url}}" />
    </div>

    <div class="titre">
      <h3>{{item.artist}}</h3>
      <h1>{{item.title}}</h1>
    </div>

    <!-- Player -->
    <div class="lecteur">
      <audio class="fc-media" id="fc-media" preload="metadata" style="width:100%">
        <source src="{% if item.audio_file %}{{ item.audio_file.url }}{% else %}{{ item.audio_link }}{% endif %}" type="audio/mp3"/>
      </audio>

      <!-- Custom controls strip -->
      <div class="tf-controls">
        <button class="btn icon" id="btnPlayPause" title="Play/Pause">
          <i class="fa fa-play"></i>
        </button>
        <button class="btn icon" id="btnBack" title="Seek -5s">
          <i class="fa fa-undo"></i>
        </button>
        <button class="btn icon" id="btnFwd" title="Seek +5s">
          <i class="fa fa-repeat"></i>
        </button>
        <div class="time">
          <span id="currTime">0:00</span>
          <span class="sep">/</span>
          <span id="durTime">0:00</span>
        </div>
        <div class="vol">
          <i class="fa fa-volume-up"></i>
          <input type="range" id="volRange" min="0" max="1" step="0.01" />
        </div>
        {% if item.audio_file %}
        <a class="btn ghost" id="btnDownload" href="{{ item.audio_file.url }}" download title="Download">
          <i class="fa fa-download"></i>
        </a>
        {% endif %}
        <!-- Add lyrics fetch button if no lyrics exist -->
        {% if not item.lyrics %}
        <button class="btn ghost" id="btnFetchLyrics" title="Fetch Lyrics (Ctrl+L)" 
                data-artist="{{ item.artist }}" data-title="{{ item.title }}">
          <i class="fa fa-music"></i>
        </button>
        {% endif %}
      </div>

      <!-- Waveform -->
      <canvas id="waveform" height="56" class="wave glass"></canvas>
    </div>
  </section>

  <!-- Right: Lyrics -->
  <aside class="right-section glass">
    <div class="lyrics-header">
      <div class="badge glow">Live Lyrics</div>
      <div class="scroll-note">
        <i class="fa fa-magic"></i> auto-scroll enabled
        {% if not item.lyrics %}
        <span style="margin-left: 8px; opacity: 0.7;">â€¢ Press Ctrl+L to fetch</span>
        {% endif %}
      </div>
    </div>
    <div class="lyrics-container" id="lyricsContainer">
      <div id="lyricsList"
           class="lyrics"
           data-lyrics='{{ item.formatted_lyrics|safe }}'>
      </div>
    </div>
  </aside>
  {% endfor %}
</div>